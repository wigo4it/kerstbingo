<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Kwartaalmeeting zomer 2024</title>
	<link rel="stylesheet" href="game.css">
</head>

<style>
	.rotate {
		--animation-duration: 1s;
		--animation-divisor: 1;
	}
</style>

<body>
	<button id="button">Win een CO2 meter!</button>
	<div id="textBox"></div>
	<canvas id="confetti"></canvas>
	<audio id="wachtMuziekje" src="wachtMuziekje.mp3" type="audio/mp3"></audio>
	<audio id="winnaar" src="winnaar.mp3" type="audio/mp3"></audio>

	<script src="confetti.js"></script>

	<script>
		document.addEventListener('DOMContentLoaded', function () {
			const button = document.getElementById('button');
			const textBox = document.getElementById('textBox');
			let names = [];

			fetch('game.csv')
				.then(response => response.text())
				.then(data => {
					names = data.split(',');
					console.log(names);
				});

			// Function to shuffle the names array
			function shuffle(array) {
				for (let i = array.length - 1; i > 0; i--) {
					const j = Math.floor(Math.random() * (i + 1));
					[array[i], array[j]] = [array[j], array[i]];
				}
			}

			// Function to handle the action
			function handleAction() {
				const self = button;
				textBox.classList.remove('final-name');
				self.classList.remove('rotate');
				void self.offsetWidth;
				self.classList.add('rotate');

				// Select the audio element
				const audioElement = document.getElementById('wachtMuziekje');

				// Play the audio
				audioElement.play();

				// Stop the audio after 10 seconds

				document.getElementById('confetti').style.display = 'none';

				shuffle(names);  // Shuffle the names before displaying them randomly

				let currentIndex = 0;
				const intervalTime = 2; //141
				const totalTime = 1000;

				const interval = setInterval(function () {
					if (names.length > 0) {
						if (names[currentIndex] === 'Golden Ticket!') {
							textBox.style.color = 'gold';
						} else {
							textBox.style.color = ''; // Reset to default color
						}
						textBox.textContent = names[currentIndex];
						currentIndex = (currentIndex + 1) % names.length;
					}
				}, intervalTime);

				setTimeout(function () {
					textBox.style.color = '';
					clearInterval(interval);
					if (names.length > 0) {
						const randomIndex = Math.floor(Math.random() * names.length);
						if (names[randomIndex] === 'Golden Ticket!') {
							textBox.classList.add('final-name');
							document.getElementById('confetti').style.display = 'block';
							document.getElementById('winnaar').play();
							textBox.textContent = 'Golden Ticket!';
							setTimeout(() => {
								audioElement.pause();
								audioElement.currentTime = 0; // Reset the audio to the beginning
							}, 100000); // 100000 milliseconds = 100 seconds

						} else {
							textBox.textContent = names[randomIndex]; // Display a random name
							setTimeout(() => {
								audioElement.pause();
								audioElement.currentTime = 0; // Reset the audio to the beginning
							}, 5000);
						}
						self.classList.remove('rotate');
					}
				}, totalTime);
			}

			// Add event listener for the button click
			button.addEventListener('click', handleAction);

			// Add event listener for the Enter key press
			document.addEventListener('keydown', function (event) {
				if (event.key === 'Enter' || event.key === ' ') {
					handleAction();
				}
			});

		});
	</script>
</body>

</html>
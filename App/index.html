<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Techorama 2024</title>
	<link rel="icon" href="/icons/favicon.ico" type="image/x-icon">
	<link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
	<link rel="manifest" href="/icons/site.webmanifest">
	<link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#5bbad5">
	<link rel="stylesheet" href="game.css">
</head>

<body>
	<button id="button">Win een CO2 meter!</button>
	<div id="textBox"></div>
	<canvas id="confetti"></canvas>
	<audio id="wachtMuziekje" src="assets/wachtMuziekje.mp3" type="audio/mp3"></audio>
	<audio id="winnaar" src="assets/winnaar.mp3" type="audio/mp3"></audio>

	<script src="confetti.js"></script>

	<script>
		const audioElement = document.getElementById('wachtMuziekje');
		document.addEventListener('DOMContentLoaded', function () {
			const button = document.getElementById('button');
			const textBox = document.getElementById('textBox');
			let names = ['CO2 Meter!', 'Ticket'];

			// Function to shuffle the names array
			function shuffle(array) {
				for (let i = array.length - 1; i > 0; i--) {
					const j = Math.floor(Math.random() * (i + 1));
					[array[i], array[j]] = [array[j], array[i]];
				}
			}
			// Function to determine the final text
			function determineFinalText() {
				const randomNumber = Math.floor(Math.random() * 30);  // Generate a number between 0 and 49
				return randomNumber === 31 ? "CO2 Meter!" : "Ticket"; // 2% chance to be "Golden Ticket"
			}

			// Function to handle the action
			function handleAction() {
				const self = button;
				textBox.classList.remove('final-name');
				self.classList.remove('rotate');
				void self.offsetWidth;
				self.classList.add('rotate');

				// Play the audio
				audioElement.play();

				// Stop the audio after 10 seconds
				document.getElementById('confetti').style.display = 'none';

				shuffle(names);  // Shuffle the names before displaying them randomly

				let currentIndex = 0;
				const intervalTime = 350;
				const totalTime = 10020;

				const interval = setInterval(function () {
					if (names.length > 0) {
						textBox.style.color = ''; // Reset to default color
						textBox.textContent = names[currentIndex];
						currentIndex = (currentIndex + 1) % names.length;
					}
				}, intervalTime);
				setTimeout(function () {
					textBox.style.color = '';
					clearInterval(interval);
					const finalText = determineFinalText(); // Determine final text and store it in a variable
					textBox.textContent = finalText;
					textBox.classList.add('final-name');
					document.getElementById('confetti').style.display = 'block';
					document.getElementById('winnaar').play();

					// Only pause the audio and reset if the text is not "CO2 Meter!"
					if (finalText !== "CO2 Meter!") {
						setTimeout(() => {
							audioElement.pause();
							audioElement.currentTime = 0; // Reset the audio to the beginning
						}, 100); // Adjust the timeout as needed
					}
					self.classList.remove('rotate');
				}, totalTime);
			}

				// Add event listener for the button click
				button.addEventListener('click', handleAction);

				// Add event listener for the Enter key press
				document.addEventListener('keydown', function (event) {
					if (event.key === 'Enter' || event.key === ' ') {
						handleAction();
					}
					if (event.shiftKey && event.key.toLowerCase() === 'g') {
						window.location.href = 'game.html';
					}
				});

			});
	</script>
</body>

</html>